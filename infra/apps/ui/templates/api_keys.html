{% extends "base.html" %}
{% block content %}

<h2>API Keys</h2>

{% if new_key %}
  <div style="padding:12px; border:1px solid #ccc; margin:12px 0;">
    <b>Copy this API key now â€” it will not be shown again.</b><br/><br/>
    <code style="display:block; padding:10px; border:1px solid #eee; word-break:break-all;">
      {{ new_key.api_key }}
    </code>
    <div style="margin-top:6px;">
      Prefix: <code>{{ new_key.prefix }}</code>
    </div>
  </div>
{% endif %}

<form action="/settings/api-keys/create" method="post" style="margin:12px 0;">
  <label>Name (optional)</label><br/>
  <input type="text" name="name" placeholder="e.g. prod, staging" />
  <button type="submit">Create new key</button>
</form>

<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Prefix</th>
    <th>Name</th>
    <th>Created</th>
    <th>Last used</th>
    <th>Status</th>
    <th>Action</th>
  </tr>

  {% for k in keys %}
  <tr>
    <td><code>{{ k.prefix }}</code></td>
    <td>{{ k.name or "" }}</td>
    <td>{{ k.created_at|fmt_dt }}</td>
    <td>{{ k.last_used_at|fmt_dt }}</td>
    <td>
      {% if k.revoked_at %}
        revoked
      {% else %}
        active
      {% endif %}
    </td>
    <td>
      {% if not k.revoked_at %}
      <form action="/settings/api-keys/{{ k.key_id }}/revoke" method="post" style="margin:0;">
        <button type="submit">Revoke</button>
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>

{% endblock %}
