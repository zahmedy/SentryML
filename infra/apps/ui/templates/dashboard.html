{% extends "base.html" %}
{% block content %}

<h2>Dashboard</h2>

<h3>Open Incidents</h3>
{% if open_incidents|length == 0 %}
  <p>No open incidents ðŸŽ‰</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Model</th>
    <th>State</th>
    <th>PSI</th>
    <th>Opened</th>
  </tr>
  {% for i in open_incidents %}
  <tr>
    <td><a href="/models/{{ i.model_id }}">{{ i.model_id }}</a></td>
    <td>{{ i.state }}</td>
    <td>{{ i.value }}</td>
    <td>{{ i.opened_at }}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<h3 style="margin-top:20px;">Latest Drift</h3>
{% if latest_drift|length == 0 %}
  <p>No drift results yet.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Model</th>
    <th>Status</th>
    <th>PSI</th>
    <th>Computed</th>
  </tr>
  {% for d in latest_drift %}
  <tr>
    <td><a href="/models/{{ d.model_id }}">{{ d.model_id }}</a></td>
    <td>{{ d.status }}</td>
    <td>{{ d.psi_score if d.psi_score is defined else d.value if d.value is defined else "" }}</td>
    <td>{{ d.computed_at }}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<h3 style="margin-top:20px;">Models</h3>
{% if models|length == 0 %}
  <p>No models yet.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Model</th>
    <th>Events</th>
    <th>Last Seen</th>
    <th>Monitoring</th>
  </tr>
  {% for m in models %}
  <tr>
    <td><a href="/models/{{ m.model_id }}">{{ m.model_id }}</a></td>
    <td>{{ m.event_count }}</td>
    <td>{{ m.last_seen_at }}</td>
    <td>
      {% if not m.monitor_enabled %}
        Disabled
        <form action="/models/{{ m.model_id }}/monitoring/enable" method="post" style="display:inline;">
          <button type="submit">Enable</button>
        </form>
      {% else %}
        Enabled
        <form action="/models/{{ m.model_id }}/monitoring/disable" method="post" style="display:inline;">
          <button type="submit">Disable</button>
        </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endif %}

{% endblock %}
