{% extends "base.html" %}
{% block content %}

<h2>Dashboard</h2>
<p style="color:#666; margin-top:-6px;">
  Monitoring runs on a scheduled worker. Changes apply on the next run.
</p>
{% if onboarding %}
  <div style="margin:12px 0; padding:12px; border:1px solid #d1d5db; background:#f9fafb;">
    <b>Welcome to SentryML.</b>
    Create an API key in Settings, then start sending prediction events to see models appear here.
  </div>
{% endif %}

{% if models|length == 0 %}
  <p>No models yet. Send prediction events to see models appear.</p>
{% else %}
<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Model</th>
      <th>Events</th>
      <th>Last Seen</th>
      <th>Last PSI</th>
      <th>Drift</th>
      <th>Incident</th>
      <th>Monitoring</th>
    </tr>
  </thead>
  <tbody>
    {% for m in models %}
    <tr>
      <!-- Model -->
      <td>
        <a href="/models/{{ m.model_id }}">{{ m.model_id }}</a>
      </td>

      <!-- Events -->
      <td>{{ m.event_count or 0 }}</td>

      <!-- Last Seen -->
      <td>{{ m.last_seen_at|fmt_dt }}</td>

      <!-- Last PSI -->
      <td>
        {{ m.last_psi_score|fmt_num }}
      </td>

      <!-- Drift -->
      <td>
        {% if m.drift_severity == "ok" %}
          ðŸŸ¢ ok
        {% elif m.drift_severity == "warn" %}
          ðŸŸ¡ warn
        {% elif m.drift_severity == "critical" %}
          ðŸ”´ critical
        {% else %}
          â€”
        {% endif %}
      </td>

      <!-- Incident -->
      <td>
        {% if m.open_incident_id %}
          <a href="/incidents/{{ m.open_incident_id }}">
            {% if m.open_incident_severity == "warn" %}ðŸŸ¡{% elif m.open_incident_severity == "critical" %}ðŸ”´{% endif %}
            {{ m.open_incident_status }}
            ({{ (m.open_incident_id|string)[:10] }})
          </a>
        {% else %}
          â€”
        {% endif %}
      </td>

      <!-- Monitoring -->
      <td>
        {% if m.monitor_enabled %}
          Enabled
          <form
            action="/models/{{ m.model_id }}/monitoring/disable"
            method="post"
            style="display:inline"
          >
            <button type="submit">Disable</button>
          </form>
        {% else %}
          Disabled
          <form
            action="/models/{{ m.model_id }}/monitoring/enable"
            method="post"
            style="display:inline"
          >
            <button type="submit">Enable</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

{% endblock %}
