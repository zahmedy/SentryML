{% extends "base.html" %}
{% block content %}

<h2>Model: {{ model_id }}</h2>

<h3>Incidents</h3>
{% if incidents|length == 0 %}
  <p>No incidents for this model.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>State</th>
    <th>PSI</th>
    <th>Opened</th>
    <th>Closed</th>
  </tr>
  {% for i in incidents %}
  <tr>
    <td>{{ i.state }}</td>
    <td>{{ i.value }}</td>
    <td>{{ i.opened_at }}</td>
    <td>{{ i.closed_at or "" }}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<h3 style="margin-top:20px;">Drift History</h3>
{% if drift|length == 0 %}
  <p>No drift results yet.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Computed</th>
    <th>PSI</th>
    <th>Baseline</th>
    <th>Current</th>
  </tr>
  {% for d in drift %}
  <tr>
    <td>{{ d.computed_at }}</td>
    <td>{{ d.psi_score }}</td>
    <td>{{ d.baseline_start }} → {{ d.baseline_end }} (n={{ d.baseline_n }})</td>
    <td>{{ d.current_start }} → {{ d.current_end }} (n={{ d.current_n }})</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<h3 style="margin-top:20px;">Recent Predictions</h3>
{% if recent_predictions|length == 0 %}
  <p>No prediction events yet.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Time</th>
    <th>Entity</th>
    <th>Prediction</th>
    <th>Score</th>
  </tr>
  {% for p in recent_predictions %}
  <tr>
    <td>{{ p.event_time }}</td>
    <td>{{ p.entity_id }}</td>
    <td>{{ p.prediction }}</td>
    <td>{{ "%.4f"|format(p.score) if p.score is not none else "" }}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}


{% endblock %}
