{% extends "base.html" %}
{% block content %}

<h2>Model: {{ model_id }}</h2>

<h3>Incidents</h3>
{% if incidents|length == 0 %}
  <p>No incidents for this model.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>State</th>
    <th>PSI</th>
    <th>Opened</th>
    <th>Closed</th>
  </tr>
  {% for i in incidents %}
  <tr>
    <td>{{ i.state }}</td>
    <td>{{ i.value|fmt_num }}</td>
    <td>{{ i.opened_at|fmt_dt }}</td>
    <td>{{ i.closed_at|fmt_dt }}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<h3 style="margin-top:20px;">Drift History</h3>
{% if drift|length == 0 %}
  <p>No drift results yet.</p>
{% else %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Computed</th>
    <th>PSI</th>
    <th>Baseline</th>
    <th>Current</th>
  </tr>
  {% for d in drift %}
  <tr>
    <td>{{ d.computed_at|fmt_dt }}</td>
    <td>{{ d.psi_score|fmt_num }}</td>
    <td>{{ d.baseline_start }} → {{ d.baseline_end }} (n={{ d.baseline_n }})</td>
    <td>{{ d.current_start }} → {{ d.current_end }} (n={{ d.current_n }})</td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<form method="get" action="/models/{{ model_id }}" style="margin:10px 0;">
  <label>Recent predictions</label>
  <select name="pred_limit" onchange="this.form.submit()">
    <option value="50"  {% if pred_limit == 50 %}selected{% endif %}>50</option>
    <option value="200" {% if pred_limit == 200 %}selected{% endif %}>200</option>
    <option value="1000" {% if pred_limit == 1000 %}selected{% endif %}>1000</option>
  </select>
</form>

<h3 style="margin-top:20px;">Recent Predictions</h3>

<form method="get" action="/models/{{ model_id }}" style="margin:10px 0;">
  <label>Show last</label>
  <select name="pred_limit" onchange="this.form.submit()">
    <option value="50"  {% if pred_limit == 50 %}selected{% endif %}>50</option>
    <option value="200" {% if pred_limit == 200 %}selected{% endif %}>200</option>
    <option value="1000" {% if pred_limit == 1000 %}selected{% endif %}>1000</option>
  </select>
</form>

{% if recent_predictions|length == 0 %}
  <p>No prediction events yet.</p>
{% else %}
<div style="max-height:700px; overflow-y:auto; border:1px solid #ddd; padding:6px;">
  <table border="1" cellpadding="6" cellspacing="0" width="100%">
    <tr>
      <th>Time</th>
      <th>Entity</th>
      <th>Prediction</th>
      <th>Score</th>
    </tr>
    {% for p in recent_predictions %}
    <tr>
      <td>{{ p.event_time|fmt_dt }}</td>
      <td>{{ p.entity_id }}</td>
      <td>{{ p.prediction }}</td>
      <td>
        {% if p.score is not none %}
          {{ p.score|fmt_num }}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
</div>
{% endif %}

{% endblock %}
